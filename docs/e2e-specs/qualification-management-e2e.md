# 資格管理ページ E2Eテスト仕様書

生成日: 2025-12-25
対象ページ: `/register`
権限レベル: 認証なし（MVPでは全ユーザーアクセス可）

---

## テスト環境

```yaml
URL: http://localhost:3247/register
認証: なし（社員選択ドロップダウンで制御）
テスト用社員:
  - 田中太郎（本社・管理部）
  - 佐藤花子（関連会社A・技術部）
  - 鈴木次郎（関連会社B・営業部）
```

---

## 統合テストでカバー済み（E2Eから除外）

- ✅ **404エラー（存在しない資格・社員）**: backend/tests/integration/qualification/qualification.flow.test.ts
- ✅ **409エラー（重複資格登録）**: backend/tests/integration/qualification/qualification.flow.test.ts
- ✅ **400エラー（バリデーション）**: backend/tests/integration/qualification/qualification.flow.test.ts
- ✅ **CRUD正常系API**: backend/tests/integration/qualification/qualification.flow.test.ts
- ✅ **期限計算ロジック**: backend/tests/integration/qualification/qualification.flow.test.ts

---

## E2Eテスト項目一覧（UIフローのみ: 8項目）

| ID | テスト項目 | 期待結果 |
|----|----------|---------|
| E2E-QUAL-001 | ページアクセス・初期表示 | /register にアクセス → ヘッダー・3つのセクション（社員選択・資格登録・資格一覧）が表示される |
| E2E-QUAL-002 | 社員選択・資格一覧表示 | 社員ドロップダウンから社員選択 → 選択した社員の保有資格がテーブルに表示される |
| E2E-QUAL-003 | 登録フォーム有効化フロー | 初期状態：社員未選択時は入力フィールドが無効 → 社員選択後にフィールドが有効化される |
| E2E-QUAL-004 | 資格名入力・期限自動計算 | 資格名・取得日を入力 → 有効期限フィールドに期限が自動計算表示される |
| E2E-QUAL-005 | 資格登録完了フロー | フォーム入力 → 登録ボタンクリック → ローディング表示 → 保有資格一覧に新規資格が反映される |
| E2E-QUAL-006 | 資格削除確認ダイアログフロー | 資格削除ボタンクリック → 確認ダイアログ表示 → キャンセルボタン → ダイアログ閉じる・変更なし |
| E2E-QUAL-007 | 資格削除完了フロー | 資格削除ボタンクリック → 確認ダイアログ → 削除ボタンクリック → 保有資格一覧から該当資格が消失 |
| E2E-QUAL-008 | ステータスチップ表示確認 | 保有資格一覧の状態列に各資格のステータスチップ（有効・期限切迫・期限切れ）が適切に表示される |

---

## 詳細テストケース

### E2E-QUAL-001: ページアクセス・初期表示
**操作手順:**
1. ブラウザでhttp://localhost:3247/registerにアクセス
2. ページ読み込み完了を待機

**期待結果:**
- メインレイアウトが表示される
- ページタイトル「資格登録・管理」が表示される
- 3つのセクションが表示される：
  - 社員選択セクション
  - 新規資格登録セクション
  - 保有資格一覧セクション

### E2E-QUAL-002: 社員選択・資格一覧表示
**操作手順:**
1. 社員選択ドロップダウンをクリック
2. 社員一覧が表示されることを確認
3. 任意の社員（例：田中太郎）を選択

**期待結果:**
- ドロップダウンに「田中太郎（本社・管理部）」形式で社員が表示される
- 選択した社員の保有資格がテーブルに表示される
- 資格がない場合は「この社員の資格情報はありません」が表示される

### E2E-QUAL-003: 登録フォーム有効化フロー
**操作手順:**
1. 初期状態で各入力フィールドの状態を確認
2. 社員を選択
3. 選択後の各入力フィールドの状態を確認

**期待結果:**
- 初期状態：資格名・取得日・登録ボタンが無効（disabled）状態
- 社員選択後：資格名・取得日フィールドが有効化される
- 有効期限フィールドは常にreadonly状態

### E2E-QUAL-004: 資格名入力・期限自動計算
**操作手順:**
1. 社員を選択
2. 資格名に「基本情報技術者試験」を入力
3. 取得日に「2024-04-15」を入力
4. 有効期限フィールドの値を確認

**期待結果:**
- 資格名・取得日入力後、有効期限フィールドが自動更新される
- 永続資格の場合「永続」が表示される
- 期限付き資格の場合、計算された有効期限日が表示される

### E2E-QUAL-005: 資格登録完了フロー
**操作手順:**
1. 社員を選択
2. 資格名・取得日を入力
3. 登録ボタンをクリック
4. ローディング状態を確認
5. 登録完了後の画面を確認

**期待結果:**
- 登録ボタンクリック時、ボタンがローディング状態になる
- 登録完了後、保有資格一覧に新規登録した資格が表示される
- フォームはクリアされる

### E2E-QUAL-006: 資格削除確認ダイアログフロー
**操作手順:**
1. 保有資格がある社員を選択
2. 任意の資格の削除ボタンをクリック
3. 確認ダイアログの内容を確認
4. キャンセルボタンをクリック

**期待結果:**
- 削除確認ダイアログが表示される
- ダイアログタイトル「削除確認」が表示される
- 確認メッセージ「この資格を削除しますか？この操作は取り消すことができません。」が表示される
- キャンセル後、ダイアログが閉じ、資格一覧に変更なし

### E2E-QUAL-007: 資格削除完了フロー
**操作手順:**
1. 保有資格がある社員を選択
2. 任意の資格の削除ボタンをクリック
3. 確認ダイアログで削除ボタンをクリック
4. 削除完了後の一覧を確認

**期待結果:**
- 削除ボタンクリック時、ボタンがローディング状態になる
- 削除完了後、該当の資格が保有資格一覧から消失する
- ダイアログが自動で閉じる

### E2E-QUAL-008: ステータスチップ表示確認
**操作手順:**
1. 複数の資格を持つ社員を選択
2. 保有資格一覧の状態列を確認

**期待結果:**
- 各資格の状態に応じたチップが表示される：
  - 有効な資格：緑色の「有効」チップ
  - 期限切迫の資格：黄色の「期限切迫」チップ
  - 期限切れの資格：赤色の「期限切れ」チップ

---

## 実行コマンド

```bash
npx playwright test tests/e2e/qualification-management.spec.ts
```

---

## 注意事項

- **認証なし設計**: MVPでは認証機能を実装しないため、すべてのユーザーが全機能にアクセス可能
- **社員選択制御**: 社員はドロップダウンで選択し、選択された社員の資格のみ操作対象となる
- **期限自動計算**: 資格名に基づいて有効期限が自動計算される（マスターデータベース）
- **リアルタイム更新**: 登録・削除操作は即座に一覧に反映される