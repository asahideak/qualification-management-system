# 5社統合資格管理システム - 要件定義書

## 要件定義の作成原則
- **「あったらいいな」は絶対に作らない**
- **拡張可能性のための余分な要素は一切追加しない**
- **将来の「もしかして」のための準備は禁止**
- **今、ここで必要な最小限の要素のみ**

## 1. プロジェクト概要

### 1.1 成果目標
5社統合の資格管理システムで、AI機能による無制限の資格検索・自動期限計算を実現し、社員の自主管理と管理者のリアルタイム把握を可能にする

### 1.2 成功指標

#### 定量的指標
- 全社員の85%以上がシステムに登録・活用している
- 資格期限切れの見落としを90%以上削減（現在のExcel管理と比較）
- AI検索により未登録資格の追加作業時間を95%以上短縮
- 新入社員の資格情報登録漏れを80%以上削減（システム連携時）

#### 定性的指標
- どんな資格でもAI検索により即座に登録・管理できている
- 新入社員も含めて全社員の資格状況が漏れなく把握できている
- 管理者が5社全体の資格コンプライアンス状況を迅速に把握できる
- 資格の種類や有効期限の違いを意識せずに運用できている

## 2. システム全体像

### 2.1 主要機能一覧
- 資格登録・管理: 社員が自分の資格情報を登録・編集
- 全社員資格一覧: 管理者が5社全体の資格状況を確認
- AI資格検索: 資格名から自動で有効期限を計算（段階的導入）
- 社員管理システム連携: 既存システムとの情報同期（将来対応）

### 2.2 ユーザーロールと権限（MVP：認証なし）
- **MVPフェーズ**: 認証機能なし、全員が全機能にアクセス可能
- **将来拡張**: 一般ユーザー（自分の資格のみ）/ 管理者（全員閲覧・編集可）の権限分離

### 2.3 認証・認可要件
- **MVP**: 認証機能なし（社内信頼ベースでの運用）
- **Phase 11拡張時**: メール+パスワード認証、基本的な権限管理

## 3. ページ詳細仕様

### 3.1 P-001: 資格登録・管理ページ

#### 目的
社員が自分や他の社員の資格情報を登録・更新し、有効期限を自動計算で管理する

#### 主要機能
- 社員選択（ドロップダウン）
- 資格名入力（事前登録40資格 + AI検索対応）
- 取得日入力
- 有効期限自動計算・表示
- 資格情報の編集・削除
- 個人の資格一覧表示

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | 社員の資格一覧取得 | 社員ID | 資格一覧データ |
| 作成 | 新規資格登録 | 社員ID、資格名、取得日 | 登録完了、有効期限自動計算 |
| 更新 | 既存資格情報更新 | 資格ID、更新内容 | 更新完了通知 |
| 削除 | 資格情報削除 | 資格ID | 削除完了通知 |

#### 処理フロー（同一画面での切り替え）
1. 社員をドロップダウンで選択（即座に下部コンテンツ更新）
2. 選択社員の既存資格一覧を表示
3. 資格名を入力（既存40資格から選択または新規入力）
4. 取得日を入力
5. システムが有効期限を自動計算・表示
6. 登録ボタンで保存完了（即座に一覧に反映）

#### UI構成
```
画面上部: [ 田中太郎 ▼ ] 社員選択ドロップダウン
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
資格登録フォーム（選択社員用）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
選択社員の既存資格一覧（編集・削除可能）
```

#### データ構造（概念）
```yaml
Employee（社員）:
  識別子: employeeId（一意の社員番号）
  基本情報:
    - name（氏名）（必須）
    - email（メールアドレス）（必須）
    - companyId（所属会社ID）（必須）
    - departmentId（部署ID）（任意）
  メタ情報:
    - createdAt（作成日時）
    - updatedAt（更新日時）

Qualification（資格）:
  識別子: qualificationId（一意の資格ID）
  基本情報:
    - employeeId（所属社員ID）（必須）
    - qualificationName（資格名）（必須）
    - acquiredDate（取得日）（必須）
    - expirationDate（有効期限）（必須、自動計算）
    - qualificationMasterId（資格マスターID）（必須）
  メタ情報:
    - createdAt（作成日時）
    - updatedAt（更新日時）
  関連:
    - Employee（多対一）
    - QualificationMaster（多対一）
```

### 3.2 P-002: 全社員資格一覧ページ

#### 目的
管理者が5社全体の資格状況を一覧で確認し、期限管理やコンプライアンス状況を把握する

#### 主要機能
- 全社員の資格一覧表示
- 会社・部署別フィルター機能
- 期限切れ・期限間近アラート表示
- CSVエクスポート機能
- 検索機能（社員名、資格名）

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | 全社員資格一覧取得 | フィルター条件 | 資格一覧データ |
| 取得 | 期限切れ資格検索 | 期限条件 | 該当資格一覧 |
| 出力 | CSVエクスポート | エクスポート条件 | CSVファイル |
| 取得 | 検索機能 | 検索キーワード | 検索結果一覧 |

#### 処理フロー
1. ページアクセス時に全社員の資格情報を表示
2. フィルター（会社、部署、期限状況）を適用
3. 検索キーワードで絞り込み
4. 期限切れアラートを色分け表示
5. CSVエクスポートで外部出力

#### データ構造（概念）
```yaml
QualificationMaster（資格マスター）:
  識別子: qualificationMasterId（一意の資格マスターID）
  基本情報:
    - masterName（資格名）（必須）
    - validityPeriod（有効期間：年）（必須）
    - category（資格カテゴリ）（任意）
    - isActive（有効フラグ）（必須）
  メタ情報:
    - createdAt（作成日時）
    - updatedAt（更新日時）
  関連:
    - Qualification（一対多）

Company（会社）:
  識別子: companyId（一意の会社ID）
  基本情報:
    - companyName（会社名）（必須）
    - isActive（有効フラグ）（必須）
  関連:
    - Employee（一対多）
```

## 4. データ設計概要

### 4.1 主要エンティティ

```yaml
Employee（社員）:
  概要: 5社に所属する全社員の基本情報
  主要属性:
    - 識別情報（社員番号、氏名、メール）
    - 所属情報（会社ID、部署ID）
  関連:
    - Qualification（一対多：1人が複数の資格を保有）
    - Company（多対一：1つの会社に複数の社員が所属）

Qualification（資格）:
  概要: 各社員が保有する資格情報
  主要属性:
    - 資格情報（資格名、取得日、有効期限）
    - 関連ID（社員ID、資格マスターID）
  関連:
    - Employee（多対一：複数の資格が1人に紐づく）
    - QualificationMaster（多対一：複数の資格が1つのマスターに紐づく）

QualificationMaster（資格マスター）:
  概要: 資格の種類と有効期間を管理するマスターデータ
  主要属性:
    - 資格定義（資格名、有効期間、カテゴリ）
    - 管理情報（有効フラグ）
  関連:
    - Qualification（一対多：1つのマスターに複数の資格が紐づく）

Company（会社）:
  概要: 5つの関連会社の情報
  主要属性:
    - 会社情報（会社名、有効フラグ）
  関連:
    - Employee（一対多：1つの会社に複数の社員が所属）
```

### 4.2 エンティティ関係図
```
Company ─── Employee ─── Qualification ─── QualificationMaster
   │           │              │                    │
（一対多）   （一対多）      （多対一）         （一対多）
   │           │              │                    │
 5つの会社    全社員      個人の資格保有        40種類の資格
```

### 4.3 バリデーションルール
```yaml
社員名:
  - ルール: 1文字以上50文字以下、必須入力
  - 理由: 社員識別と表示のため

メールアドレス:
  - ルール: 有効なメール形式、一意性
  - 理由: 将来の認証機能とアカウント識別のため

資格名:
  - ルール: 1文字以上100文字以下、必須入力
  - 理由: 資格の正確な識別のため

取得日:
  - ルール: 有効な日付形式、過去日付のみ
  - 理由: 有効期限計算の基準として必要

有効期限:
  - ルール: 取得日より未来の日付、自動計算
  - 理由: 期限管理とアラート機能のため
```

## 5. 制約事項

### 外部API制限
- **Claude API**: 月間使用量制限（200-500回）、日次制限（20-50回）
- **Neon Database**: 無料枠0.5GB、接続数制限あり

### 技術的制約
- **ファイルサイズ制限**: アップロード機能なし（MVPでは対象外）
- **同時接続数**: 初期は50ユーザー程度を想定
- **データ保持期間**: 無制限（削除機能で手動管理）

## 5.1 セキュリティ要件

### 基本方針
本プロジェクトは **CVSS 3.1（Common Vulnerability Scoring System）** に準拠したセキュリティ要件を満たすこと。

詳細な診断と改善は、Phase 11（本番運用診断）で @本番運用診断オーケストレーター が実施します。

---

### プロジェクト固有の必須要件

**認証機能がない場合（MVP）**:
- ✅ HTTPSの強制（本番環境）
- ✅ 基本的なセキュリティヘッダー設定
- ✅ 入力値のサニタイゼーション
- ✅ エラーメッセージでの情報漏洩防止

**将来拡張時（認証機能追加後）**:
- ✅ ブルートフォース攻撃対策（アカウントロックアウト）
- ✅ パスワードポリシー（8文字以上、複雑性要件）
- ✅ セッション管理（タイムアウト、CSRF対策）

---

### 運用要件：可用性とヘルスチェック

**ヘルスチェックエンドポイント（全プロジェクト必須）**:
- エンドポイント: `/api/health`
- 目的: Cloud Run/Kubernetesでのliveness/readinessプローブ
- 要件: データベース接続確認、5秒以内の応答

**グレースフルシャットダウン（全プロジェクト必須）**:
- SIGTERMシグナルハンドラーの実装
- 進行中のリクエスト完了まで待機
- タイムアウト: 8秒（Cloud Runの10秒制限に対応）

## 6. 複合API処理（バックエンド内部処理）

### 複合処理-001: 資格マスター管理（手動対応）
**トリガー**: 社員からの新規資格追加リクエスト
**フロントエンドAPI**: POST /api/qualification-masters/request
**バックエンド内部処理**:
1. 事前登録40資格との照合
2. 未登録の場合、管理者への通知
3. 管理者による手動での資格マスター追加
4. 社員への追加完了通知
**結果**: 新規資格マスター登録完了
**外部サービス依存**: なし（完全手動運用）

### 複合処理-001B: AI資格検索・登録（将来実装）
**実装時期**: Phase 3以降（7-9ヶ月目）
**トリガー**: 新規資格名入力時のAI検索
**フロントエンドAPI**: POST /api/qualifications/ai-search
**バックエンド内部処理**:
1. 事前登録資格との照合
2. 未登録の場合、Claude APIで資格情報検索
3. 有効期限情報の取得・計算
4. 資格マスターデータベースへの自動登録
**結果**: 資格名正規化と有効期限情報
**外部サービス依存**: Claude API

### 複合処理-002: 社員管理システム同期（将来実装）
**トリガー**: 日次バッチ処理または手動同期
**フロントエンドAPI**: POST /api/employees/sync
**バックエンド内部処理**:
1. 既存社員管理システムAPI呼び出し
2. 新規社員・退職社員の差分検出
3. 社員データベースの更新
4. 同期結果レポート生成
**結果**: 同期完了通知と差分レポート
**外部サービス依存**: 既存社員管理システムAPI

## 7. 技術スタック

**フロントエンド**:
- React 18 + TypeScript 5
- MUI v6（UIライブラリ）
- Zustand（状態管理）
- React Router v6（ルーティング）
- React Query（データフェッチ）
- Vite 5（ビルドツール）

**バックエンド**:
- Node.js + Express
- Prisma（ORM）
- TypeScript 5

**データベース**:
- PostgreSQL（Neon）

**インフラ**:
- フロントエンド: Vercel
- バックエンド: Google Cloud Run
- データベース: Neon（PostgreSQL）

**AI機能**:
- Claude API（Haiku 4.5）

## 8. 必要な外部サービス・アカウント

### 必須サービス
| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| Neon | PostgreSQLデータベース | https://neon.tech | 無料枠で十分 |
| Vercel | フロントエンドホスティング | https://vercel.com | 無料枠で十分 |
| Google Cloud Run | バックエンドホスティング | https://cloud.google.com | 従量課金 |

### 段階的導入サービス
| サービス名 | 用途 | 導入時期 | 備考 |
|-----------|------|--------|------|
| Claude API | AI資格検索機能 | Phase 3以降（7ヶ月目）| 手動対応で6ヶ月間コスト0円 |
| 社員管理システム | 社員情報連携 | Phase 4以降 | 将来対応 |

## 9. 今後の拡張予定

**原則**: 拡張予定があっても、必要最小限の実装のみを行う

### 段階的機能解放スケジュール

**Phase 1（MVP期間・0-3ヶ月）**:
- ✅ 基本資格管理機能
- ✅ 事前登録40資格のみ対応
- ✅ 手動資格マスター追加（管理者）
- 💰 運用コスト: 0円

**Phase 2（手動対応期間・4-6ヶ月）**:
- ✅ システム習熟・安定運用
- ✅ 新規資格の手動追加対応
- ✅ 管理者による資格マスター充実化
- 💰 運用コスト: 0円継続

**Phase 3（AI試験導入・7-9ヶ月）**:
- 🔧 制限付きAI検索機能解放
- 🔧 月50回、予算1,500円上限
- 💰 運用コスト: 月額1,500円以内

**Phase 4以降（本格運用・10ヶ月目以降）**:
- 🚀 認証・認可機能の追加
- 🚀 AI検索機能の本格運用
- 🚀 社員管理システムとの連携
- 🚀 詳細な権限管理
- 🚀 通知機能（期限切れアラート）
- 🚀 モバイル対応

拡張が必要になった時点で、Phase 11: 機能拡張オーケストレーターを使用して追加実装を行います。

---

**このMVP仕様により、最小限の機能で最大の価値を提供し、段階的な拡張が可能な資格管理システムを構築します。**